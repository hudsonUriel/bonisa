/*
* Bonisa
* http://github.com/zmdy/bonisa
* MIT Licensed
*
* Copyright (C) 2020 Hudson Uriel Ferreira, http://gihub.com/zmdy
*
*/

var Bonisa=function(){"use strict";var e={version:"1.1-alpha",engines:{impress:["div#impress>div.step"],reveal:["div.reveal>div.slides>section","div.reveal>div.slides>section>section"]}},t=500;const n=e=>new Promise(t=>setTimeout(t,e));function i(t){!function(t){t.content=function(t){var n,i,r=window.location,o=/^(\u002E{1,2}\u002F|\u002F{1})[^\u002F].{1,}(\u002F|\w{1,})$/gm;r.hostname,r.pathname.replace("/","").split("/")[0];i=t,t=t.split(/( |\u0028|\u0029|\u005B|\u005D|\u007B|\u007D)/);for(let r in t)if(o.test(t[[r]])){n=t[r];var l=e.location+"/"+n.replace(/\u002E+\u002F/g,"");i=i.replace(n,l)}return i}(t.content),t.content=function(t){var n,i={},r=1;n=t.split(e.delimiters.regexp);for(let t in n)""!=n[t].replace(e.delimiters.regexp,"")?(i["slide"+e.slides.length]={content:n[t],level:e.delimiters.text.indexOf(n[r]),isParent:!1},i["slide"+e.slides.length].level>=e.structure.length&&(i["slide"+e.slides.length].level=e.structure.length-1),e.slides.length++):r=t;return i}(t.content);for(let e in t.content)t.content[e].fileFormat=t.fileFormat;Object.assign(e.content,t.content)}(t);for(let i in t.content){var n=t.content[i];n.fileFormat||(n.fileFormat=e.fileFormat[0]),n.content=e.convert[n.fileFormat](n.content),(n=r(n)).structure.id+="bonisaSlide"+i.replace(/\D/g,""),n.structure.className+="bonisa",n.parent.appendChild(n.structure)}}function r(t){var n;return t.structure=e.structure[t.level].element.cloneNode(!0),t.structure.innerHTML=t.content,0==t.level?(t.parent=document.querySelector(e.structure[0].parent),e.slides.lastParent[t.level]++,e.slides.content.push(t)):(t.parent=e.slides.lastParent[t.level-1]-1,0==e.slides.content[t.parent].isParent&&(e.slides.content[t.parent].isParent=!0,(n=e.structure[1].element.cloneNode(!0)).innerHTML=e.slides.content[t.parent].structure.cloneNode(!0).innerHTML,n.id+="bonisaSlide"+t.parent,n.className+="bonisa",e.slides.content[t.parent].structure.innerHTML="",e.slides.content[t.parent].structure.appendChild(n)),t.parent=e.slides.content[t.parent].structure),t}function o(e){var t=new XMLHttpRequest,n=e.file,i=e.callback,r=e.format||n.split(".").slice(-1)[0],o=e.id||null;try{t.open("GET",n)}catch(e){return console.error(e),console.log("Attempt failed!"),-1}return t.send(),t.onreadystatechange=function(){if(4===t.readyState)try{i({content:t.responseText,id:o,file:n,fileFormat:r})}catch(e){return console.error(e),console.log("No function was passed as argument."),-1}},t}return e.init=function(r){var l=(r="object"==typeof r?r:{configs:r}).file||null,s=r.content||null;if(!l&!s)return e.error(),-1;!function(t){var n,r,o,l,s,c,a,d,u,f;if(n=t.callback||i,r=t.options||t.configs||{},o=t.delimiters||["---","___","***"],l=r.dependencies||[],s=t.dir||"./",c=t.engine||t.framework||t.tool||"reveal",a=t.file||null,d=t.process||function(){},u=t.themes||t.styles||[],f=t.content||null,e.location=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.replace("/","").split("/")[0],a){e.file=a,e.file=Array.isArray(e.file)?e.file:[e.file],e.fileFormat=[];for(let t in e.file)e.fileFormat.push(e.file[t].split(".").slice(-1)[0]);e.dir=s}else e.textContent=f,t.fileFormat=null==t.fileFormat?["md"]:t.fileFormat,e.fileFormat=Array.isArray(t.fileFormat)?t.fileFormat:[t.fileFormat];e.content=[],e.dependencies=l,e.delimiters={text:o,regexp:[]};for(let t in e.delimiters.text){var p="^";for(let n in e.delimiters.text[t])p+="\\u00"+e.delimiters.text[t].charCodeAt(n).toString(16);e.delimiters.regexp.push(p.replace("^",""))}e.delimiters.regexp=RegExp("^("+e.delimiters.regexp.join("|")+")$","gm"),e.engine=e.engines.hasOwnProperty(c)?c:"reveal",e.callback=n,e.structure=e.engines[e.engine],e.slides={length:0,content:[],lastParent:[]},e.config=r,e.process=d,e.convert={},e.styles=Array.isArray(u)?u:[u],e.createWait()}(r),function(){var t=[],n={md:"marked",adoc:"asciidoctor"};for(let i in e.fileFormat)-1==t.indexOf(n[e.fileFormat[i]])&&t.push(n[e.fileFormat[i]]);e.dependencies=t;for(let t in e.dependencies){var i=document.createElement("script");i.src=e.location+"/libs/"+e.dependencies[t]+"/"+e.dependencies[t]+".min.js",document.head.appendChild(i)}}(),n(t).then(()=>{e.configConvert(),function(){var t=[];for(let c in e.structure){var n=e.structure[c].split(">");for(let c in n){var i,r,o,l=n[c],s={};if(l.split("#")!=l?s.id=l.split("#")[1]:l.split(".")!=l&&(s.class=l.split(".")[1]),i=l.split(/\u0023|\u002e/gm)[0],o=0==c?"body":n[c-1],o+=">"+n[c],r=0==c?"body":t[c-1].selector,!document.querySelector(o)){l=document.createElement(i);for(let e in s)l.setAttribute(e,s[e]);t[c]={element:l,parent:r,selector:o},r=document.querySelector(r),c<e.structure.length&&r.appendChild(l)}}}e.rootStructure=t[0].selector,document.querySelector(e.rootStructure).id+="bonisaRoot",e.structure=t.slice(e.structure.length)}(),l?function(){for(let t in e.file)o({file:e.dir+e.file[t],callback:e.callback})}():e.callback({content:s}),n(t).then(()=>{!function(){e.process(),e.stylize(),o=e.location+"/libs/",i=document.createElement("script"),r=document.createElement("link"),i.src=o+e.engine+"/"+e.engine+".min.js",r.rel="stylesheet",r.type="text/css",r.href=o+e.engine+"/"+e.engine+".min.css",document.body.appendChild(i),document.body.appendChild(r),n(t).then(()=>{switch(e.wait.style.display="none",e.engine){case"impress":impress().init(e.config);break;case"reveal":Reveal.initialize(e.config)}});var i,r,o}(),delete e.configConvert,delete e.location,delete e.slides})})},e.clear=function(){var t=document.querySelector(e.rootStructure);t.parentNode.removeChild(t)},e.configConvert=function(){for(let n in e.fileFormat){var t;switch(e.fileFormat[n]){case"md":t=marked;break;case"adoc":t=asciidoctor.convert}e.convert[e.fileFormat[n]]||(e.convert[e.fileFormat[n]]=t)}for(let t=0;t<e.structure.length;t++)e.slides.lastParent[t]=0},e.createWait=function(){var t=document.createElement("div");t.innerHTML=e.wait||"<img src='"+e.location+"/media/img/loading.gif' style='width:15vw;margin-left:42.5%;margin-top:32.5vh;margin-bottom:2%;'>\n<p style='text-align: center;'>Loading... please, wait...</p>",t.style.display="inline-block",t.style.visibility="visible",t.style.width="100vw",t.style.height="100vh",document.body.appendChild(t),e.wait=t},e.error=function(){console.log("%cYou've got an error message, don't you? If you did, read this: ","color: #44d; font-weight: bold; font-size: 1.5em;"),console.log("%cHouston, we've got a problem...\n\n%cIt's kind of... impossible to create a presentation without a text file. To configure it do this:\n\n%cBonisa.init({\n\tfile: 'yourFileName.extension',\n\tdir: 'file/directory/location',\n\tengine: 'engine-name'\n});","color: #111; text-transform: uppercase; font-size: 1.25em; font-weight: bold;","color: #111;","color: #44f; font-family: monospace; padding: 2%;"),alert("ERROR: No input file was selected to create the presentation. Open DevTools (F12) to more details ;)")},e.stylize=function(){for(let n in e.styles){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e.styles[n],document.head.appendChild(t)}},e}();